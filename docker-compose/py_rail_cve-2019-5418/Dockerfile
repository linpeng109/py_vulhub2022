FROM vulhub/rails:5.2.2

LABEL maintainer="phithon <root@leavesongs.com>"

RUN apt update -y \
    && apt install -y vim openssh-server lsof \
    && sed -i 's#UsePAM yes#UsePAM no#g' /etc/ssh/sshd_config \
    && sed -i '$aPermitRootLogin yes' /etc/ssh/sshd_config \
    && ssh-keygen -t rsa -f /etc/ssh/sshd_host_rsa_key -P "" \
    && echo 'root:admin' | chpasswd \
    && set -ex \
    && rails generate controller vulhub \
    && { \
        echo 'class VulhubController < ApplicationController'; \
        echo '  def index'; \
        echo '    render file: "#{Rails.root}/public/robots.txt"'; \
        echo '  end'; \
        echo 'end'; \
    } > app/controllers/vulhub_controller.rb \
    && { \
        echo 'Rails.application.routes.draw do'; \
        echo "  get 'robots', to: 'vulhub#index'"; \
        echo 'end'; \
    } > config/routes.rb 
ENTRYPOINT service ssh restart && tail -F /var/log/apt/history.log
